@using K9.SharedLibrary.Helpers.Html
@using K9.WebApplication.Options
@model IEnumerable<Article>
@{
    ViewBag.Title = Dictionary.LatestArticles;
    ViewBag.SubTitle = Dictionary.LatestArticles;
    Layout = "../Shared/_LayoutForm.cshtml";

    var tags = ViewBag.AllTags as List<string>;
}

@Html.Partial("_BetaPopup")

<div class="container main-content">
    <article class="margin-bottom-0">
        <div class="well padding-left-0 padding-right-0 margin-bottom-0">
            <div class="row">
                <div class="col-sm-6">
                    @Html.Partial("../Shared/Controls/_SearchBox", new SearchBoxOptions
                    {
                        CssSelector = ""
                    })
                </div>
                <div class="col-sm-6 text-right">
                    <div id="tagFilters" class="btn-group" style="margin-top: 5px;">
                        @foreach (var tag in tags)
                        {
                            <button class="btn btn-default btn-sm" onclick="filterByTag('@tag')">#@tag</button>
                        }
                    </div>
                </div>
            </div>

            <div id="blogGrid" class="row">
                @foreach (var post in Model)
                {
                    <div class="col-sm-6 col-md-4 blog-card">
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <h4><a href="@Url.Action("Details", "Blog", new { id = post.Id })">@post.Title</a></h4>
                                <p class="text-muted"><small>@post.PublishedOnText</small></p>
                                <p>@post.Summary</p>

                                <p>
                                    @foreach (var tag in post.Tags)
                                    {
                                        <span class="label label-info">#@tag</span>
                                        @:&nbsp;
                                    }
                                </p>

                                <p>
                                    <a href="@Url.Action("Details", "Blog", new { id = post.Id })" class="read-more">Read more →</a>
                                </p>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </article>
</div>

<script>
    $(function () {
        function filterByTag(tag) {
            $('#Search').val(tag);
            filterPosts();
        }

        $('#Search').on('input', filterPosts);

        function filterPosts() {
            var input = $('#Search').val().toLowerCase();
            $('#blogGrid .blog-card').each(function () {
                var $card = $(this);
                var text = $card.text().toLowerCase();
                $card.toggle(text.indexOf(input) !== -1);
            });
        }

        window.filterByTag = filterByTag;
    });
</script>
