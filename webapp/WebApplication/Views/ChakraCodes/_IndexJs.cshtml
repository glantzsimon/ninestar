@using K9.WebApplication.Enums
@model K9.WebApplication.Models.ChakraCodesModel

<script type="text/javascript">

    $(function() {
        $(".chakra-code-planner-item").click(function() {
            var $el = $(this);
            var forecastType = $el.attr("data-forecast-type");
            var offset = ($el.attr("data-offset") || 0);
            var $panel, $container;
            var dateOfBirth = new Date('@Model.PersonModel.DateOfBirth.ToString("yyyy-MM-dd")');
            var dateOfBirthString = dateOfBirth.toISOString(); // Convert Date object to ISO string
            
            if (forecastType === "@EForecastType.Yearly") {
                $panel = $("#twelve-year-outlook");
                $container = $("#yearly-forecast-container");
            }
            else if (forecastType === "@EForecastType.Monthly") {
                $panel = $("#twelve-month-outlook");
                $container = $("#monthly-forecast-container");
            }
            else if (forecastType === "@EForecastType.Daily") {
                $panel = $("#daily-outlook");
                $container = $("#daily-forecast-container");
            }

            $container.find(".month-chakra-code-container").removeClass("current");
            $el.closest(".month-chakra-code-container").addClass("current");

            ajaxcontroller().get("@Url.Action("CalculateForecast", "ChakraCodes")", {forecastType, dateOfBirth: dateOfBirthString, offset}).done(
                function(result) {
                    if (result.success) {
                        $panel.find(".panel-title-text").html(result.data.Title);
                        $panel.find(".panel-body").html(result.data.Forecast);
                    }
                });
        });
    });

</script>