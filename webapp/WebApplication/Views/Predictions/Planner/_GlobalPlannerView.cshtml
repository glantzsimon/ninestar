@using K9.SharedLibrary.Extensions
@using K9.WebApplication.Config
@using K9.WebApplication.Enums
@using K9.WebApplication.Helpers

@model K9.WebApplication.ViewModels.PlannerViewModel

@{
    var activeChild = Model.Energies.FirstOrDefault(e => e.IsActive);
}

<div class="container main-content clear-both global-planner-container">
    @Html.HiddenFor(e => e.SelectedDateTimeString)
    @Html.Hidden("PlannerView", (int)Model.View)

    <div class="row margin-0">
        <div class="col-sm-4 col-xs-12 padding-0">
            @Html.BootstrapEditorFor(e => e.View)
        </div>
    </div>

    <hr />

    <div class="parent-planner">
        <!-- Parent Block -->
        <div class="parent-block planner-item-container">

            <!-- Top Row: Parent Summary -->
            <div class="global-planner-item" data-energy="@Model.Energy.Energy" data-type="parent" data-view="@Model.View" data-selected-date="@Model.PeriodStartsOnDateTimeString" data-update-url="@Model.UpdateParentUrl">
                <div class="parent-summary-row clickable">
                    <div class="parent-label">
                        <div class="parent-title">@Model.PeriodDatesTitle</div>
                        <div class="parent-dates">@Model.PeriodDatesDetails</div>
                    </div>
                    <div class="parent-detail narrow">
                        <img loading="lazy" title="@Model.Energy.EnergyName" alt="@Model.ImgAlt" class="auto-size center-block" src="@Model.ImgSrc" />
                    </div>
                    <div class="parent-detail wide">
                        <div>
                            <h4 class="margin-0">@Model.Energy.EnergyNameNumberAndElement</h4>
                        </div>
                        <div>
                            @Model.Energy.SeasonDescription / @Model.Energy.CycleDescriptiveName
                        </div>
                    </div>
                </div>
            </div>

            @switch (Model.View)
            {
                case EPlannerView.EightyOneYear:
                case EPlannerView.NineYear:
                case EPlannerView.Year:

                    <!-- Bottom Row: Child -->
                    <div class="child-row row">
                        @foreach (var energy in Model.Energies)
                        {
                            var energyTitle = Model.GetEnergyTitle(energy);
                            var datesDisplay = Model.GetEnergyDatesDetails(energy);

                            <div class="col-md-1 col-sm-1 col-xs-2 padding-0 margin-0 child-container">

                                <div class="global-planner-item" data-energy="@energy.Energy.Energy" data-view="@Model.ChildView" data-type="child" data-selected-date="@energy.EnergyStartsOnDateTimeString" data-update-url="@Model.UpdateChildUrl">

                                    <div class="planner-item-container child-block clickable @energy.SelectedCssClass">
                                        <div class="child-name">@energyTitle</div>
                                        <div class="desktop-only child-dates">@datesDisplay</div>
                                        <img loading="lazy" title="@energy.EnergyName" alt="@energy.ImageAlt" class="auto-size center-block" src="@energy.ImageSrc" />
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    break;

                case EPlannerView.Month:

                    @Html.Partial("Planner/_DailyCalendar")

                    break;
            }


        </div>
    </div>
    <hr />
    <div id="global-planner-details">
        @Html.Panel(activeChild?.Energy?.CycleDescriptiveName, activeChild?.Energy?.CycleDescription)
    </div>
</div>




