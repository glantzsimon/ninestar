@using K9.WebApplication.Enums
@using K9.WebApplication.Extensions
@model K9.WebApplication.Models.NineStarKiModel

@{
    var membership = this.GetActiveUserMembership();
    var isUnlimited = membership != null && membership.IsUnlimited() || Model.IsComplementary || K9.WebApplication.Helpers.SessionHelper.CurrentUserIsAdmin();
    var magicStyle = Model.EnergyDisplay == EEnergyDisplay.Graphical ? "display: none;" : "";
    var globalStyle = Model.ScopeDisplay == EScopeDisplay.PersonalKi ? "display: none;" : "";
    var personalStyle = Model.ScopeDisplay == EScopeDisplay.PersonalKi ? "" : "display: none;";
    var showDirectionsStyle = Model.EnergyDisplay == EEnergyDisplay.MagicSquare && K9.WebApplication.Helpers.SessionHelper.GetShowDirections() ? "" :
    "display: none;";
    var magicSquaresModel = Model.GetCycleMagicSquares();
    var globalMagicSquaresModel = Model.GetGlobalCycleMagicSquares();
    var housesOccupiedEnergies = Model.PersonalHousesOccupiedEnergies;
    var lunarHousesOccupiedEnergies = Model.PersonalHousesOccupiedLunarEnergies;
    var globalHouses = Model.GlobalCycleEnergies;
    var isDualView = Model.HousesDisplay == EHousesDisplay.SolarAndLunarHouses;
}

@if (isUnlimited)
{
    <div class="personal-cycles-container" style="@personalStyle">
        <div class="row">
            <div class="col-sm-4">
                <a href="#" class="scroll-to-tab" data-tab-id="current-yearly-cycle">
                    @if (isDualView)
                    {
                        @Html.Partial("_CycleSplitTitle", (housesOccupiedEnergies.Year, lunarHousesOccupiedEnergies.Year, false))
                    }
                    else
                    {
                        @Html.Partial("_CycleTitle", housesOccupiedEnergies.Year)
                    }
                    @Html.Partial("../NineStarKi/_MagicSquareDisplay", magicSquaresModel.Year)
                </a>
            </div>
            <div class="col-sm-4 medium-energy">
                <a href="#" class="scroll-to-tab" data-tab-id="current-monthly-cycle">
                    @if (isDualView)
                    {
                        @Html.Partial("_CycleSplitTitle", (housesOccupiedEnergies.Month, lunarHousesOccupiedEnergies.Month, false))
                    }
                    else
                    {
                        @Html.Partial("_CycleTitle", housesOccupiedEnergies.Month)
                    }
                    @Html.Partial("../NineStarKi/_MagicSquareDisplay", magicSquaresModel.Month)
                </a>
            </div>
            <div class="col-sm-4 small-energy">
                <a href="#" class="scroll-to-tab" data-tab-id="current-daily-cycle">
                    @if (isDualView || housesOccupiedEnergies.Day.EnergyNumber == housesOccupiedEnergies.Day2.EnergyNumber)
                    {
                        if (isDualView)
                        {
                            @Html.Partial("_CycleSplitTitle", (housesOccupiedEnergies.Day, lunarHousesOccupiedEnergies.Day, false))
                        }
                        else
                        {
                            @Html.Partial("_CycleTitle", housesOccupiedEnergies.Day)
                        }
                    }
                    else
                    {
                        @Html.Partial("_CycleSplitTitle", (housesOccupiedEnergies.Day, housesOccupiedEnergies.Day2, true))
                    }
                    @Html.Partial("../NineStarKi/_MagicSquareDisplay", magicSquaresModel.Day)
                </a>
            </div>
        </div>
    </div>

    <div class="global-cycles-container" style="@globalStyle">
        <div class="row">
            <div class="col-sm-4">
                <a href="#" class="scroll-to-tab" data-tab-id="current-yearly-cycle">
                    @Html.Partial("_CycleTitle", globalHouses.Year)
                    @Html.Partial("../NineStarKi/_MagicSquareDisplay", globalMagicSquaresModel.Year)
                </a>
            </div>
            <div class="col-sm-4 medium-energy">
                <a href="#" class="scroll-to-tab" data-tab-id="current-monthly-cycle">
                    @Html.Partial("_CycleTitle", globalHouses.Month)
                    @Html.Partial("../NineStarKi/_MagicSquareDisplay", globalMagicSquaresModel.Month)
                </a>
            </div>
            <div class="col-sm-4 small-energy">
                <a href="#" class="scroll-to-tab" data-tab-id="current-daily-cycle">
                    @if (housesOccupiedEnergies.Day.EnergyNumber == housesOccupiedEnergies.Day2.EnergyNumber)
                    {
                        @Html.Partial("_CycleTitle", globalHouses.Day)
                        @Html.Partial("../NineStarKi/_MagicSquareDisplay", globalMagicSquaresModel.Day)
                    }
                    else
                    {
                        @Html.Partial("_CycleSplitTitle", (globalHouses.Day, globalHouses.Day2))
                        @Html.Partial("../NineStarKi/_MagicSquareDisplay", globalMagicSquaresModel.Day)
                    }
                </a>
            </div>
        </div>
    </div>
}
else
{
    <div class="personal-cycles-container" style="@personalStyle">
        <div class="row">
            <div class="col-sm-4">
                <a href="#" class="scroll-to-tab" data-tab-id="current-yearly-cycle">
                    @Html.Partial("_CycleTitle", Model.YearlyCycleEnergy)
                </a>
            </div>
            <div class="col-sm-4 medium-energy">
                <a href="#" class="scroll-to-tab" data-tab-id="current-monthly-cycle">
                    @Html.Partial("_CycleTitle", Model.MonthlyCycleEnergy)
                </a>
            </div>
            <div class="col-sm-4 small-energy">
                <a href="#" class="scroll-to-tab" data-tab-id="current-daily-cycle">
                    @Html.Partial("_CycleTitle", Model.PersonalHousesOccupiedEnergies.Day)
                </a>
            </div>
        </div>
    </div>
}