<script language="javascript">

    function scrollCurrentYearIntoVew() {
        if ($("#YearScrollStatus").val() !== "true") {
            setTimeout(function () {
                var $cycle = $("div.current-year");
                var $yearlyPlannerContainer = ".yearly-planner-container";

                $($yearlyPlannerContainer).scrollTop($cycle.offset().top - $($yearlyPlannerContainer).offset().top);
                $("#YearScrollStatus").val(true);
            }, 200);
        }
    }

    function scrollCurrentMonthIntoVew() {
        if ($("#MonthScrollStatus").val() !== "true") {
            setTimeout(function () {
                var $cycle = $("div.current-month");
                var $monthlyPlannerContainer = ".monthly-planner-container";

                $($monthlyPlannerContainer).scrollTop($cycle.offset().top - $($monthlyPlannerContainer).offset().top);
                $("#MonthScrollStatus").val(true);
            }, 200);
        }
    }

    function scrollCyclesIntoVew(tab) {
        setTimeout(function () {
            $.fn.scrollToTopOf(tab, -230);
        }, 200);
    }

    $(function () {
        $("a[href='#yearly-planner']").click(function () {
            scrollCurrentYearIntoVew();
        });

        $("a[href='#monthly-planner']").click(function () {
            scrollCurrentMonthIntoVew();
        });

        $("#current-yearly-cycle").click(function () {
            scrollCyclesIntoVew("#yearly");

            $(".nav-pills a[href='#predictions']").tab("show");
            $(".nav-pills a[href='#yearly']").tab("show");
        });

        $("#current-monthly-cycle").click(function () {
            scrollCyclesIntoVew("#monthly");

            $(".nav-pills a[href='#predictions']").tab("show");
            $(".nav-pills a[href='#monthly']").tab("show");
        });

        $(".global-planner-item").click(function() {
            var $el = $(this);
            var energy = $el.attr("data-energy");
            var type = $el.attr("data-type");
            var $container, $yearBlock, $monthBlock, $details, url;

            $container = $el.closest(".planner-container");
            $yearBlock = $el.find(".year-block");
            $monthBlock = $el.find(".month-block");
            $details = $("#global-planner-details");

            // clear current class from all items
            $container.find(".year-block, .month-block").removeClass("active");

            // set current class on current selected item
            if (type === "year") {
                $yearBlock.addClass("active");

                url = '@Url.Action("GetYearlyForecast", "Predictions")';
            }
            else if (type === "month") {
                $monthBlock.addClass("active");

                url = '@Url.Action("GetMonthlyForecast", "Predictions")';
            }

            ajaxcontroller().get(url, {energy}).done(
                function(result) {
                    if (result.success) {
                        $details.find(".panel .panel-heading h4 strong").html(result.data.CycleDescriptiveName);
                        $details.find(".panel .panel-body").html(result.data.CycleDescription);
                    }
                });
        });

        $(".planner-item").click(function() {
            var $el = $(this);
            var energy = $el.attr("data-energy");
            var type = $el.attr("data-type");
            var $container, $plannerItem, $details;
            var url = "";

            switch (type) {
                case "year":
                    $details = $("#yearly-planner-details");
                    url = '@Url.Action("GetYearlyForecast", "Predictions")';
                    break;

                default:
                    $details = $("#monthly-planner-details");
                    url = '@Url.Action("GetMonthlyForecast", "Predictions")';
                    break;
            }

            $container = $el.closest(".planner-container");
            $plannerItem = $el.find(".planner-item-container");

            // clear current class from all items
            $container.find(".planner-item .planner-item-container").removeClass("active");

            // set current class on current selected item
            $plannerItem.addClass("active");

            ajaxcontroller().get(url, {energy}).done(
                function(result) {
                    if (result.success) {
                        $details.find(".panel .panel-heading h4 strong").html(result.data.CycleDescriptiveName);
                        $details.find(".panel .panel-body").html(result.data.CycleDescription);
                    }
                });
        });
    });

</script>