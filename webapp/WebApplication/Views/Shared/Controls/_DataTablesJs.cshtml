@using System.Globalization
@using K9.SharedLibrary.Extensions
@model IDataTableOptions
<script type="text/javascript">

	function @Model.GetButtonRenderFunction() (data) {
		var buttons = "";
		var join = '@Model.GetQueryStringJoiner()';
		if (@Model.AllowDetail.ToString().ToLower()) {
			buttons += '<a href="@Url.Action("Details", Model.GetFilterRouteValues())' + join + 'id=' + data.Id + '" class="btn btn-info">@Dictionary.Details</a>';
		}
		if (@Model.AllowEdit.ToString().ToLower()) {
			buttons += '<a href="@Url.Action("Edit", Model.GetFilterRouteValues())' + join + 'id=' +data.Id + '" class="btn btn-primary"><i class="fa fa-pencil"></i> @Dictionary.Edit</a>';
		}
		if (@Model.AllowDelete.ToString().ToLower()) {
			buttons += '<a href="@Url.Action("Delete", Model.GetFilterRouteValues())' + join + 'id=' + data.Id + '" class="btn btn-danger"><i class="fa fa-trash"></i> @Dictionary.Delete</a>';
		}
		return buttons == "" ? null : buttons;
	};

	function getColumnDefs() {
		var columnDefs = @Model.GetColumnDefsJson();
		if (@Model.AllowCrud().ToString().ToLower()) {
			columnDefs.push({
				data: null,
				targets: [@Model.GetColumnInfos().Count],
				render: @Model.GetButtonRenderFunction()
			});
		}

		$(columnDefs).each(function(cdef) {
			if (cdef.linkedTableName) {
				cdef.render = 
			}
		});

		return columnDefs;
	}

	$(function() {
		var table = @Model.TableId = $("table#@Model.TableId");
		table.DataTable({
			"ajax": table.attr("data-url"),
			"columns": @Model.GetColumnsJson(),
			"columnDefs": getColumnDefs(),
			"processing": true,
			"serverSide": true,
			"stateSave": true,
			"language": {
                "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/@string.Format("{0}.json", CultureInfo.CurrentUICulture.GetLocaleLanguage())"
            }
		});
	});

</script>
